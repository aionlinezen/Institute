{% extends "base.html" %}

{% block title %}{{ institute.institute_name }} - Online Coaching Institute{% endblock %}

{% block description %}Join {{ institute.institute_name }} for quality education and expert coaching. Online registration, study materials, and proven results.{% endblock %}

{% block keywords %}{{ institute.institute_name }}, coaching institute, online education, study materials, entrance exam preparation{% endblock %}

{% block og_title %}{{ institute.institute_name }} - Best Coaching Institute{% endblock %}

{% block og_description %}Enroll at {{ institute.institute_name }} for comprehensive coaching programs. Expert faculty, quality education, and proven track record.{% endblock %}

{% block content %}
<!-- Structured Data for SEO -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "EducationalOrganization",
  "name": "{{ institute.institute_name }}",
  "description": "{{ institute.why_choose_us.split('\n')[0] if institute.why_choose_us else 'Quality coaching institute' }}",
  "url": "{{ request.url }}",
  "sameAs": [
    "{{ request.url_root }}institute/{{ institute.username }}"
  ],
  "offers": {
    "@type": "Offer",
    "name": "Coaching Program",
    "price": "{{ institute.amount }}",
    "priceCurrency": "INR"
  }
}
</script>

<!-- Header Section -->
<div class="hero-section text-center">
    <div class="container">
        <h1 class="display-4 mb-3" itemprop="name">{{ institute.institute_name }}</h1>
        {% if institute.offer_text %}
        <div class="alert alert-warning d-inline-block">
            <i class="fas fa-star"></i> {{ institute.offer_text }}
        </div>
        {% endif %}
    </div>
</div>

<div class="container my-5">
    <!-- Why Choose Us Section -->
    <section class="mb-5" itemscope itemtype="https://schema.org/AboutPage">
        <h2 class="text-center mb-4" itemprop="name">Why Choose Us?</h2>
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        {% for point in institute.why_choose_us.split('\n') %}
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-check-circle text-success me-3"></i>
                            <span>{{ point }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Download Section -->
    {% if institute.pdf_filename %}
    <section class="mb-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card bg-primary text-white text-center">
                    <div class="card-body">
                        <i class="fas fa-download fa-3x mb-3"></i>
                        <h4>{{ institute.pdf_title }}</h4>
                        <p>Get access to our latest question papers and study materials</p>
                        <a href="/download/{{ institute.username }}/{{ institute.pdf_filename }}" 
                           class="btn btn-light btn-lg">
                            <i class="fas fa-file-pdf"></i> Download PDF
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    {% endif %}

    <!-- Registration Section -->
    <section class="mb-5">
        <h2 class="text-center mb-4">Register Now</h2>
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <form id="registrationForm">
                            <div class="mb-3">
                                <label for="name" class="form-label">Full Name *</label>
                                <input type="text" class="form-control" id="name" name="name" required>
                            </div>
                            <div class="mb-3">
                                <label for="email" class="form-label">Email Address *</label>
                                <input type="email" class="form-control" id="email" name="email" required>
                            </div>
                            <div class="mb-3">
                                <label for="phone" class="form-label">Phone Number *</label>
                                <input type="tel" class="form-control" id="phone" name="phone" required>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-success btn-lg">
                                    <i class="fas fa-user-plus"></i> Register & Pay
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Testimonials Section -->
    {% if institute.testimonials %}
    <section class="mb-5">
        <h2 class="text-center mb-4">What Our Students Say</h2>
        <div class="row">
            {% for testimonial in institute.testimonials %}
            <div class="col-md-6 mb-4">
                <div class="card testimonial-card h-100">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            {% if testimonial.image %}
                            <img src="{{ testimonial.image }}" alt="{{ testimonial.name }}" 
                                 class="rounded-circle me-3" width="60" height="60">
                            {% else %}
                            <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-3" 
                                 style="width: 60px; height: 60px;">
                                <i class="fas fa-user text-white"></i>
                            </div>
                            {% endif %}
                            <div>
                                <h6 class="mb-0">{{ testimonial.name }}</h6>
                                <small class="text-muted">Student</small>
                            </div>
                        </div>
                        <p class="mb-0">"{{ testimonial.text }}"</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    $('#registrationForm').on('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        
        $.ajax({
            url: '/register/{{ institute.username }}',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                if (response.success) {
                    alert('Registration successful! Redirecting to payment...');
                    window.location.href = response.payment_url;
                } else {
                    alert('Registration failed: ' + response.error);
                }
            },
            error: function() {
                alert('An error occurred. Please try again.');
            }
        });
    });
});
</script>
{% endblock %}